<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignUp Skin Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.error {
            background-color: #dc3545;
        }
        .toast.warning {
            background-color: #ffc107;
            color: #212529;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .modal-title {
            margin: 0;
            font-size: 18px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }
        .modal-body {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }
        .instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            max-width: 300px;
        }
        .instructions h3 {
            margin: 0 0 12px 0;
            font-size: 14px;
            font-weight: 600;
        }
        .instructions p {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #666;
        }
        .instructions ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        .instructions li {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <div id="signup-skin-container"></div>
    <div id="toast-container"></div>
    <div id="modal-container"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 빌드된 스킨 파일들 로드 -->
    <link rel="stylesheet" href="../dist/signup-skin.css">
    <script src="../dist/signup-skin.umd.js"></script>
    
    <!-- 디버깅용 로그 -->
    <script>
        console.log('HTML loaded');
        window.addEventListener('load', function() {
            console.log('Window loaded');
            console.log('SignUpSkin available:', typeof SignUpSkin);
            console.log('React available:', typeof React);
            console.log('ReactDOM available:', typeof ReactDOM);
        });
    </script>
    
    <script>
        // ✅ API 문서 패턴에 맞는 Mock data
        const mockData = {
            // 폼 데이터
            formData: {
                user_id: '',
                password: '',
                name: '',
                phone: '',
                email: '',
                birthday: '',
                address: '',
                referral_code: '',
                var01: '',
                var02: '',
                var03: ''
            },
            
            // 상태
            loading: false,
            signUpSuccess: false,
            signUpError: null,
            validationErrors: {},
            
            // 기본 필드 표시 설정
            basicFields: {
                userId: true,
                password: true,
                name: true,
                phone: true,
                email: true,
                birthday: false,
                address: false,
                referralCode: true
            },
            
            // 커스텀 필드 설정 (var01~var10)
            varFields: {
                var01: {
                    show: true,
                    label: '직업',
                    type: 'text',
                    required: false
                },
                var02: {
                    show: true,
                    label: '성별',
                    type: 'radio',
                    required: true,
                    options: [
                        { label: '남성', value: 'male' },
                        { label: '여성', value: 'female' },
                        { label: '기타', value: 'other' }
                    ]
                },
                var03: {
                    show: true,
                    label: '마케팅 동의',
                    type: 'checkbox',
                    required: false
                }
            },
            
            // 정책 및 설정
            isSpecifiedLegPolicy: false,
            companyId: 1,
            policies: {},
            
            // 테마
            theme: {
                primaryColor: '#667eea',
                secondaryColor: '#6c757d',
                backgroundColor: '#f8f9fa'
            },
            
            // 전역 앱 데이터
            withcookieData: {},
            isUserLoggedIn: false,
            isAdminLoggedIn: false
        };

        // ✅ API 문서 패턴에 맞는 Mock actions
        const mockActions = {
            // ✅ 제공되는 액션들
            handleSubmit: (event) => {
                event.preventDefault();
                console.log('Form submitted!');
                
                // 실제로는 Logic 레이어에서 처리됨
                // 임시로 성공 시뮬레이션
                setTimeout(() => {
                    // 폼 데이터 업데이트 (실제로는 Redux를 통해)
                    mockData.loading = false;
                    mockData.signUpSuccess = true;
                    
                    // 리렌더링 트리거
                    rerenderComponent();
                }, 2000);
                
                // 로딩 상태 시작
                mockData.loading = true;
                rerenderComponent();
            },
            
            handleChange: (event) => {
                const { id, value } = event.target;
                console.log('Field changed:', id, value);
                
                // 폼 데이터 업데이트
                mockData.formData[id] = value;
                
                // 에러 클리어 (해당 필드)
                if (mockData.validationErrors[id]) {
                    delete mockData.validationErrors[id];
                }
                
                // 실시간 검증 시뮬레이션
                if (id === 'user_id' && value === 'admin') {
                    mockData.validationErrors.user_id = '이미 사용 중인 아이디입니다.';
                } else if (id === 'email' && value === 'test@example.com') {
                    mockData.validationErrors.email = '이미 사용 중인 이메일입니다.';
                } else if (id === 'password' && value.length > 0 && value.length < 8) {
                    mockData.validationErrors.password = '비밀번호는 8자 이상이어야 합니다.';
                }
                
                rerenderComponent();
            },
            
            handleBlur: (fieldName) => {
                console.log('Field blurred:', fieldName);
                // 실제로는 Logic에서 유효성 검사 수행
            },
            
            handleRadioChange: (fieldName, value) => {
                console.log('Radio changed:', fieldName, value);
                mockData.formData[fieldName] = value;
                rerenderComponent();
            },
            
            handleCheckboxChange: (fieldName, label, checked) => {
                console.log('Checkbox changed:', fieldName, label, checked);
                mockData.formData[fieldName] = checked ? label : '';
                rerenderComponent();
            },
            
            validateField: (fieldName, value) => {
                console.log('Validating field:', fieldName, value);
                // 실제로는 Logic에서 처리
            },
            
            validateForm: () => {
                console.log('Validating form');
                // 실제로는 Logic에서 처리
                return true;
            }
        };

        // ✅ 간소화된 옵션 (필요시 확장)
        const mockOptions = {
            title: 'Marijour 회원가입',
            subtitle: '마리쥬르와 함께 시작해보세요'
        };

        // Utility functions
        const showToast = (message, type = 'success') => {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        };

        const openModal = (content) => {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                </div>
            `;
            document.getElementById('modal-container').appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        };

        const closeModal = () => {
            const modalContainer = document.getElementById('modal-container');
            modalContainer.innerHTML = '';
        };

        const navigate = (path) => {
            console.log('Navigating to:', path);
            showToast(`페이지 이동: ${path}`, 'warning');
        };

        // ✅ API 문서 패턴의 utils
        const mockUtils = {
            t: (key) => {
                // 간단한 번역 함수
                const translations = {
                    '회원가입': 'Sign Up',
                    '아이디': 'ID',
                    '비밀번호': 'Password',
                    '이름': 'Name',
                    '전화번호': 'Phone',
                    '이메일': 'Email',
                    '입력': 'Input',
                    '동의합니다': 'I Agree',
                    '회원가입 완료!': 'Sign Up Complete!',
                    '환영합니다! 잠시 후 페이지가 이동됩니다.': 'Welcome! Page will redirect shortly.',
                    '회원가입 처리 중...': 'Processing Sign Up...',
                    '이미 계정이 있으신가요? 로그인하기': 'Already have an account? Sign In'
                };
                return translations[key] || key;
            },
            navigate,
            formatCurrency: (amount) => `₩${amount.toLocaleString()}`,
            formatDate: (date) => new Date(date).toLocaleDateString('ko-KR'),
            getAssetUrl: (path) => path,
            cx: (...classes) => classes.filter(Boolean).join(' ')
        };
        
        // 컴포넌트 리렌더링 함수
        let renderFunction;
        
        const rerenderComponent = () => {
            if (renderFunction) {
                renderFunction();
            }
        };

        // ✅ API 문서 패턴의 props
        const getProps = () => ({
            data: mockData,
            actions: mockActions,
            options: mockOptions,
            utils: mockUtils,
            mode: 'production', // 'editor' | 'preview' | 'production'
            app: {
                user: null,
                company: { name: 'Marijour' },
                currentLanguage: 'ko',
                theme: mockData.theme
            }
        });

        // Instructions for testing
        const instructions = `
            <div class="instructions">
                <h3>API 패턴 테스트 안내</h3>
                <p><strong>테스트할 아이디:</strong> admin (중복)</p>
                <p><strong>테스트할 이메일:</strong> test@example.com (중복)</p>
                <ul>
                    <li>Logic 레이어에서 제공하는 data/actions 사용</li>
                    <li>상태 관리 없이 props만 사용</li>
                    <li>정확한 input ID 사용 (user_id, password 등)</li>
                    <li>커스텀 필드 (var01~var03) 테스트</li>
                </ul>
            </div>
        `;

        // Wait for the component to be loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Add test instructions
            document.body.insertAdjacentHTML('beforeend', instructions);
            
            const container = document.getElementById('signup-skin-container');
            const root = ReactDOM.createRoot(container);
            
            // 렌더링 함수 설정
            renderFunction = () => {
                root.render(React.createElement(SignUpSkin, getProps()));
            };
            
            // 초기 렌더링
            if (typeof SignUpSkin !== 'undefined') {
                renderFunction();
                console.log('✅ SignUpSkin loaded successfully with API pattern!');
            } else {
                console.error('❌ SignUpSkin component not found');
            }
        });
    </script>
</body>
</html>